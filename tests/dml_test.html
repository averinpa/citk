

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Double Machine Learning (DML) CI Test &mdash; CITK  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Conformalized Residual Independence Test (CRIT)" href="crit_test.html" />
    <link rel="prev" title="Random Forest CI Test" href="random_forest_test.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            CITK
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../guides/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/choosing_a_test.html">How to Choose a Conditional Independence Test</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/interpreting_results.html">Interpreting Test Results</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Theoretical Foundations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../theory/what_is_ci.html">What is Conditional Independence?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory/taxonomy_of_tests.html">A Taxonomy of Conditional Independence Tests</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Conditional Independence Tests</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Conditional Independence Test Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="chi_sq_test.html">Chi-Squared Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="g_sq_test.html">G-Squared Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="fisher_z_test.html">Fisher’s Z Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="spearman.html">Spearman’s Rho Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="logit_test.html">Logistic Regression Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="poisson_test.html">Poisson Regression Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="regression_test.html">Linear Regression Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="kci_test.html">Kernel Conditional Independence (KCI) Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="random_forest_test.html">Random Forest CI Test</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Double Machine Learning (DML) CI Test</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mathematical-formulation">Mathematical Formulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#properties-and-assumptions">Properties and Assumptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#code-example">Code Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#api-reference">API Reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="crit_test.html">Conformalized Residual Independence Test (CRIT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="edml_test.html">E-Value Double Machine Learning (EDML) CI Test</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/citk.html">API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CITK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Conditional Independence Test Reference</a></li>
      <li class="breadcrumb-item active">Double Machine Learning (DML) CI Test</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tests/dml_test.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="double-machine-learning-dml-ci-test">
<h1>Double Machine Learning (DML) CI Test<a class="headerlink" href="#double-machine-learning-dml-ci-test" title="Link to this heading"></a></h1>
<p>The Double Machine Learning (DML) Conditional Independence test is a modern, robust method for assessing conditional independence, drawing on the framework developed by Chernozhukov et al. (2018). It is designed to provide reliable statistical inference even when the relationships between variables are complex and high-dimensional. DML achieves this by using flexible machine learning models to control for confounding variables (<code class="docutils literal notranslate"><span class="pre">Z</span></code>) and then performing a statistical test on the “cleaned” or residualized variables. The application of DML has been extended to causal structure learning from observational data under minimal assumptions, allowing for the identification of direct causes and other causal relationships (Soleymani, 2024).</p>
<section id="mathematical-formulation">
<h2>Mathematical Formulation<a class="headerlink" href="#mathematical-formulation" title="Link to this heading"></a></h2>
<p>The core idea of DML is to test for the conditional independence of <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">Y</span></code> given <code class="docutils literal notranslate"><span class="pre">Z</span></code> by first “partialling out” or removing the influence of <code class="docutils literal notranslate"><span class="pre">Z</span></code> from both <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">Y</span></code>. This is framed as a problem of estimating nuisance functions.</p>
<ol class="arabic">
<li><p><strong>Nuisance Prediction</strong>: Two machine learning models are trained to capture the relationships between the conditioning set <code class="docutils literal notranslate"><span class="pre">Z</span></code> and the variables of interest, <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">Y</span></code>. These relationships are the “nuisance functions.”</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(g(Z) = E[Y | Z]\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(f(Z) = E[X | Z]\)</span></p></li>
</ul>
<p>To avoid biases from overfitting, DML employs a crucial technique called <strong>cross-fitting</strong> (or sample splitting). The data is split into <em>k</em> folds. For each fold, models for <span class="math notranslate nohighlight">\(f\)</span> and <span class="math notranslate nohighlight">\(g\)</span> are trained on the other <em>k-1</em> folds and then used to predict on the held-out fold. This ensures that the predictions for each data point are generated by a model that was not trained on that point.</p>
</li>
<li><p><strong>Residual Computation</strong>: Using the out-of-sample predictions (<span class="math notranslate nohighlight">\(\hat{f}\)</span> and <span class="math notranslate nohighlight">\(\hat{g}\)</span>), residuals are computed for each observation:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(V = Y - \hat{g}(Z)\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(U = X - \hat{f}(Z)\)</span>
These residuals represent the parts of <code class="docutils literal notranslate"><span class="pre">Y</span></code> and <code class="docutils literal notranslate"><span class="pre">X</span></code> that are orthogonal to (or unexplained by) <code class="docutils literal notranslate"><span class="pre">Z</span></code>.</p></li>
</ul>
</li>
<li><p><strong>Residual Independence Test</strong>: If <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">Y</span></code> are conditionally independent given <code class="docutils literal notranslate"><span class="pre">Z</span></code>, then their residuals, <code class="docutils literal notranslate"><span class="pre">U</span></code> and <code class="docutils literal notranslate"><span class="pre">V</span></code>, should be independent. The final step is to perform a simple independence test on these residuals. This implementation uses a <strong>permutation test on the distance correlation</strong> of <code class="docutils literal notranslate"><span class="pre">U</span></code> and <code class="docutils literal notranslate"><span class="pre">V</span></code>, which is a powerful non-parametric test for dependence.</p></li>
</ol>
<p>This two-stage procedure makes the final test “doubly robust,” meaning it is less sensitive to estimation errors in the nuisance functions than a more naive approach would be.</p>
</section>
<section id="properties-and-assumptions">
<h2>Properties and Assumptions<a class="headerlink" href="#properties-and-assumptions" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><strong>Model Agnostic</strong>: Any supervised machine learning model (e.g., Gradient Boosting, Random Forest, Ridge Regression) can be used for the nuisance prediction stage.</p></li>
<li><p><strong>Robustness</strong>: By using cross-fitting and focusing the final test on residuals, DML provides valid statistical inference even when the nuisance functions are complex and estimated with flexible models.</p></li>
<li><p><strong>Assumptions</strong>: The primary assumption is that the machine learning models are sufficiently powerful and well-tuned to consistently estimate the underlying nuisance functions. The quality of the test relies on the quality of these models and the cross-fitting procedure.</p></li>
</ul>
</section>
<section id="code-example">
<h2>Code Example<a class="headerlink" href="#code-example" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">citk.tests</span><span class="w"> </span><span class="kn">import</span> <span class="n">DML</span>

<span class="c1"># Generate data with a linear relationship: X -&gt; Z -&gt; Y</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">Z</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">X</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
<span class="n">Y</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">Z</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

<span class="c1"># Initialize the test. A custom model can also be passed, e.g., model=Ridge().</span>
<span class="n">dml_test</span> <span class="o">=</span> <span class="n">DML</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Test for unconditional independence (should be dependent)</span>
<span class="n">p_unconditional</span> <span class="o">=</span> <span class="n">dml_test</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P-value (unconditional) for X _||_ Y: </span><span class="si">{</span><span class="n">p_unconditional</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Test for conditional independence given Z (should be independent)</span>
<span class="n">p_conditional</span> <span class="o">=</span> <span class="n">dml_test</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P-value (conditional) for X _||_ Y | Z: </span><span class="si">{</span><span class="n">p_conditional</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="api-reference">
<h2>API Reference<a class="headerlink" href="#api-reference" title="Link to this heading"></a></h2>
<p>For a full list of parameters, see the API documentation: :class:<code class="docutils literal notranslate"><span class="pre">citk.tests.ml_based_tests.DML</span></code>.</p>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Chernozhukov, V., Chetverikov, D., Demirer, M., Duflo, E., Hansen, C., Newey, W., &amp; Robins, J. (2018). Double/debiased machine learning for treatment and structural parameters. <em>The Econometrics Journal, 21</em>(1), C1-C68.</p></li>
<li><p>Soleymani, A. (2024). <em>Causal Structure Learning through Double Machine Learning</em>. Massachusetts Institute of Technology.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="random_forest_test.html" class="btn btn-neutral float-left" title="Random Forest CI Test" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="crit_test.html" class="btn btn-neutral float-right" title="Conformalized Residual Independence Test (CRIT)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Pavel Averin.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>